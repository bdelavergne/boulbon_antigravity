<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chateau de Boulbon | Provence</title>
  <link rel="stylesheet" href="./src/styles/main.css" />
  <link rel="icon" href="./src/assets/favicon.png" type="image/png">
  <script type="module" src="./src/scripts/main.js"></script>
</head>

<body>
  <nav class="navbar">
    <a href="/" class="nav-logo">Chateau de Boulbon</a>
    <div class="nav-links">
      <a href="/history.html"><span data-lang="en">History</span><span data-lang="fr">Histoire</span></a>
      <a href="/agenda.html"><span data-lang="en">Agenda</span><span data-lang="fr">Agenda</span></a>
      <a href="/contact.html"><span data-lang="en">Contact</span><span data-lang="fr">Contact</span></a>
    </div>
    <div class="lang-toggle">
      <span data-lang-btn="en" class="active">EN</span>
      <span data-lang-btn="fr">FR</span>
    </div>
  </nav>

  <section class="hero">
    <img src="./src/assets/Chateau_de_Boulbon.jpg" alt="Chateau de Boulbon" class="hero-bg">
    <div class="hero-content">
      <h1 class="hero-title">
        <span data-lang="en">The Night Watch</span>
        <span data-lang="fr">La Veillée</span>
      </h1>
      <p class="hero-subtitle">
        <span data-lang="en">A timeless sanctuary in Provence</span>
        <span data-lang="fr">Un sanctuaire intemporel en Provence</span>
      </p>
    </div>
    <div class="scroll-indicator">↓</div>
  </section>

  <div class="image-break parallax-bg"
    style="background-image: url('./src/assets/dinner_atmosphere.png'); height: 40vh;"></div>

  <section class="pillars-grid">
    <a href="/history.html" class="pillar-card">
      <h3>
        <span data-lang="en">Legacy</span>
        <span data-lang="fr">Héritage</span>
      </h3>
      <p>
        <span data-lang="en">1000 years of history</span>
        <span data-lang="fr">1000 ans d'histoire</span>
      </p>
    </a>
    <a href="/agenda.html" class="pillar-card">
      <h3>
        <span data-lang="en">Season</span>
        <span data-lang="fr">Saison</span>
      </h3>
      <p>
        <span data-lang="en">Cultural encounters</span>
        <span data-lang="fr">Rencontres culturelles</span>
      </p>
    </a>
    <a href="/contact.html" class="pillar-card">
      <h3>
        <span data-lang="en">Hospitality</span>
        <span data-lang="fr">Hospitalité</span>
      </h3>
      <p>
        <span data-lang="en">Private events</span>
        <span data-lang="fr">Événements privés</span>
      </p>
    </a>
  </section>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-col">
        <p>Chateau de Boulbon</p>
        <p>13150 Boulbon</p>
        <p>Provence, France</p>
      </div>
      <div class="footer-col">
        <a href="mailto:contact@chateauboulbon.com">contact@chateauboulbon.com</a>
        <a href="tel:+33490000000">+33 4 90 00 00 00</a>
      </div>
      <div class="footer-col">
        <a href="#" target="_blank">Instagram</a>
        <a href="#" target="_blank">Facebook</a>
      </div>
      <div class="footer-col">
        <a href="/legal.html">
          <span data-lang="en">Legal & Privacy</span>
          <span data-lang="fr">Mentions Légales</span>
        </a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>&copy; 2025 Chateau de Boulbon</span>
    </div>
  </footer>
  <script type="module">
    import { getHomePage, urlFor } from './src/scripts/sanity.js';

    async function loadHomePage() {
      try {
        const home = await getHomePage();
        if (!home) return;

        // Hero
        if (home.hero) {
          if (home.hero.image) {
            document.querySelector('.hero-bg').src = urlFor(home.hero.image).width(1920).url();
          }
          if (home.hero.title) {
            document.querySelector('.hero-title [data-lang="en"]').textContent = home.hero.title.en;
            document.querySelector('.hero-title [data-lang="fr"]').textContent = home.hero.title.fr;
          }
          if (home.hero.subtitle) {
            document.querySelector('.hero-subtitle [data-lang="en"]').textContent = home.hero.subtitle.en;
            document.querySelector('.hero-subtitle [data-lang="fr"]').textContent = home.hero.subtitle.fr;
          }
        }

        // Page Builder Modules
        if (home.modules && home.modules.length > 0) {
          // Find the container where modules should be injected.
          // In this design, modules come AFTER the hero.
          // We need to clear existing static content (interlude + pillars) first.
          const interludeStatic = document.querySelector('.image-break');
          if (interludeStatic) interludeStatic.remove();

          const pillarsStatic = document.querySelector('.pillars-grid');
          if (pillarsStatic) pillarsStatic.remove();

          const mainContainer = document.querySelector('body');
          const footer = document.querySelector('.footer');

          home.modules.forEach(module => {
            if (module._type === 'interludeSection') {
              const section = document.createElement('div');
              section.className = 'image-break parallax-bg';
              section.style.height = '40vh';
              if (module.image) {
                section.style.backgroundImage = `url(${urlFor(module.image).width(1920).url()})`;
              }
              mainContainer.insertBefore(section, footer);
            } else if (module._type === 'pillarsSection') {
              const section = document.createElement('section');
              section.className = 'pillars-grid';

              if (module.pillars) {
                module.pillars.forEach(pillar => {
                  const link = pillar.link || '#';
                  const card = document.createElement('a');
                  card.href = link;
                  card.className = 'pillar-card';

                  if (pillar.image) {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'pillar-image-container';
                    const img = document.createElement('img');
                    img.src = urlFor(pillar.image).width(800).height(800).url(); // Square crop
                    img.alt = pillar.title ? (pillar.title.en || pillar.title.fr) : 'Pillar Image';
                    imgContainer.appendChild(img);
                    card.appendChild(imgContainer);
                  }

                  let titleHtml = '';
                  if (pillar.title) {
                    titleHtml = `<h3>
                                    <span data-lang="en">${pillar.title.en}</span>
                                    <span data-lang="fr">${pillar.title.fr}</span>
                                </h3>`;
                  }

                  let descHtml = '';
                  if (pillar.description) {
                    descHtml = `<p>
                                    <span data-lang="en">${pillar.description.en}</span>
                                    <span data-lang="fr">${pillar.description.fr}</span>
                                </p>`;
                  }

                  const textContainer = document.createElement('div');
                  textContainer.innerHTML = titleHtml + descHtml;
                  card.appendChild(textContainer);

                  section.appendChild(card);
                });
              }
              mainContainer.insertBefore(section, footer);
            } else if (module._type === 'textSection') {
              const section = document.createElement('section');
              section.className = 'section';
              section.style.minHeight = 'auto'; // Override min-height for text sections
              section.style.padding = '4rem 2rem';

              if (module.content) {
                section.innerHTML = `
                        <div class="section-text" style="margin-bottom: 0;">
                            <span data-lang="en">${module.content.en ? module.content.en.replace(/\n/g, '<br>') : ''}</span>
                            <span data-lang="fr">${module.content.fr ? module.content.fr.replace(/\n/g, '<br>') : ''}</span>
                        </div>
                    `;
              }
              mainContainer.insertBefore(section, footer);
            }
          });
        }

      } catch (error) {
        console.error('Error loading home page:', error);
      }
    }

    loadHomePage();
  </script>
</body>

</html>